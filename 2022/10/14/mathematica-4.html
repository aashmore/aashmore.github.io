<!DOCTYPE html>
<html lang="en" data-dark="false">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!--
  put your analytics (e.g. Google Analytics) tracking code here
-->

  <!--
  put your search engine verification (e.g. Google Search Console) tag here
-->

  


























<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Mathematica tips for numerical linear algebra (4) | Ashmore Lab</title>

<link rel="icon" href="/images/icon.png">

<meta name="title" content="Mathematica tips for numerical linear algebra (4)">
<meta name="description" content="Computational physics and ML research group. A computational physics and machine learning research group at Skidmore College.">

<meta property="og:title" content="Mathematica tips for numerical linear algebra (4)">
<meta property="og:site_title" content="Ashmore Lab">
<meta property="og:description" content="Computational physics and ML research group. A computational physics and machine learning research group at Skidmore College.">
<meta property="og:url" content="https://aashmore.github.io">
<meta property="og:image" content="/images/share.jpg">
<meta property="og:locale" content="en_US">

<meta property="twitter:title" content="Mathematica tips for numerical linear algebra (4)">
<meta property="twitter:description" content="Computational physics and ML research group. A computational physics and machine learning research group at Skidmore College.">
<meta property="twitter:url" content="https://aashmore.github.io">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="/images/share.jpg">


  <meta name="author" content="anthony-ashmore">
  <meta property="og:type" content="article">
  <meta property="og:updated_time" content="">
  <meta property="article:published_time" content="2022-10-14T00:00:00+00:00">
  <meta property="article:modified_time" content="">
  <meta name="revised" content="">


<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "BlogPosting",
      "author": { "@type": "Person", "name": "Mathematica tips for numerical linear algebra (4)" },
      "datePublished": "2022-10-14T00:00:00+00:00",
      "dateModified": "",
    
    "name": "Mathematica tips for numerical linear algebra (4)",
    "description": "Computational physics and ML research group. A computational physics and machine learning research group at Skidmore College.",
    "headline": "Mathematica tips for numerical linear algebra (4)",
    "publisher": {
      "@type": "Organization",
      "logo": { "@type": "ImageObject", "url": "/images/icon.png" }
    },
    "url": "https://aashmore.github.io"
  }
</script>

<link rel="alternate" type="application/rss+xml" href="https://aashmore.github.io/feed.xml">

  <!-- Google Fonts -->
<!-- automatically get url from fonts used in theme file -->

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?display=swap&&family=Nunito:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600&amp;family=Roboto+Mono:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600" rel="stylesheet">

<!-- Font Awesome icons (load asynchronously due to size) -->

<link href="https://use.fontawesome.com/releases/v6.5.0/css/all.css" rel="stylesheet" media="none" onload="this.removeAttribute('media'); this.onload = null;">
<noscript>
  <link href="https://use.fontawesome.com/releases/v6.5.0/css/all.css" rel="stylesheet">
</noscript>

  <!-- third party styles -->
<!-- https://stylishthemes.github.io/Syntax-Themes/pygments/ -->
<link href="https://cdn.jsdelivr.net/gh/StylishThemes/Syntax-Themes/pygments/css-github/pygments-tomorrow-night-eighties.css" rel="stylesheet">

<!-- include all sass in styles folder -->


  
    <link href="/_styles/-theme.css" rel="stylesheet">
  

  
    <link href="/_styles/alert.css" rel="stylesheet">
  

  
    <link href="/_styles/all.css" rel="stylesheet">
  

  
    <link href="/_styles/anchor.css" rel="stylesheet">
  

  
    <link href="/_styles/background.css" rel="stylesheet">
  

  
    <link href="/_styles/body.css" rel="stylesheet">
  

  
    <link href="/_styles/bold.css" rel="stylesheet">
  

  
    <link href="/_styles/button.css" rel="stylesheet">
  

  
    <link href="/_styles/card.css" rel="stylesheet">
  

  
    <link href="/_styles/checkbox.css" rel="stylesheet">
  

  
    <link href="/_styles/citation.css" rel="stylesheet">
  

  
    <link href="/_styles/code.css" rel="stylesheet">
  

  
    <link href="/_styles/cols.css" rel="stylesheet">
  

  
    <link href="/_styles/dark-toggle.css" rel="stylesheet">
  

  
    <link href="/_styles/feature.css" rel="stylesheet">
  

  
    <link href="/_styles/figure.css" rel="stylesheet">
  

  
    <link href="/_styles/float.css" rel="stylesheet">
  

  
    <link href="/_styles/font.css" rel="stylesheet">
  

  
    <link href="/_styles/footer.css" rel="stylesheet">
  

  
    <link href="/_styles/form.css" rel="stylesheet">
  

  
    <link href="/_styles/grid.css" rel="stylesheet">
  

  
    <link href="/_styles/header.css" rel="stylesheet">
  

  
    <link href="/_styles/heading.css" rel="stylesheet">
  

  
    <link href="/_styles/highlight.css" rel="stylesheet">
  

  
    <link href="/_styles/icon.css" rel="stylesheet">
  

  
    <link href="/_styles/image.css" rel="stylesheet">
  

  
    <link href="/_styles/link.css" rel="stylesheet">
  

  
    <link href="/_styles/list.css" rel="stylesheet">
  

  
    <link href="/_styles/main.css" rel="stylesheet">
  

  
    <link href="/_styles/paragraph.css" rel="stylesheet">
  

  
    <link href="/_styles/portrait.css" rel="stylesheet">
  

  
    <link href="/_styles/post-excerpt.css" rel="stylesheet">
  

  
    <link href="/_styles/post-info.css" rel="stylesheet">
  

  
    <link href="/_styles/post-nav.css" rel="stylesheet">
  

  
    <link href="/_styles/quote.css" rel="stylesheet">
  

  
    <link href="/_styles/rule.css" rel="stylesheet">
  

  
    <link href="/_styles/search-box.css" rel="stylesheet">
  

  
    <link href="/_styles/search-info.css" rel="stylesheet">
  

  
    <link href="/_styles/section.css" rel="stylesheet">
  

  
    <link href="/_styles/table.css" rel="stylesheet">
  

  
    <link href="/_styles/tags.css" rel="stylesheet">
  

  
    <link href="/_styles/textbox.css" rel="stylesheet">
  

  
    <link href="/_styles/tooltip.css" rel="stylesheet">
  

  
    <link href="/_styles/util.css" rel="stylesheet">
  


<!-- include all css in styles folder -->



  <!-- third party scripts -->
<script src="https://unpkg.com/@popperjs/core@2" defer></script>
<script src="https://unpkg.com/tippy.js@6" defer></script>
<script src="https://unpkg.com/mark.js@8" defer></script>

<!-- include all js in scripts folder -->


  <script src="/_scripts/anchors.js"></script>

  <script src="/_scripts/dark-mode.js"></script>

  <script src="/_scripts/fetch-tags.js"></script>

  <script src="/_scripts/search.js"></script>

  <script src="/_scripts/site-search.js"></script>

  <script src="/_scripts/table-wrap.js"></script>

  <script src="/_scripts/tooltip.js"></script>


<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

  <body>
    







<header class="background" style="--image: url('/images/background.jpg')" data-dark="true">
  <a href="/" class="home">
    
      <span class="logo">
        
          <svg xmlns="http://www.w3.org/2000/svg" viewbox="-40 -60 80 100">
  <style>
    .bubble {
      animation: float 2s ease-out both infinite var(--delay);
    }
    @keyframes float {
      0% {
        opacity: 0;
      }
      50% {
        transform: translateY(0);
        opacity: 0;
      }
      75% {
        opacity: 1;
      }
      100% {
        opacity: 0;
        transform: translateY(-40px);
      }
    }
  </style>
  <g fill="currentColor" opacity="0.5">
    <circle class="bubble" cx="0" cy="-10" r="3" style="--delay: 0.1s"></circle>
    <circle class="bubble" cx="0" cy="-10" r="3" style="--delay: 0.4s"></circle>
    <circle class="bubble" cx="0" cy="-10" r="3" style="--delay: 1.1s"></circle>
  </g>
  <path fill="#38bdf8" d="
      M 0 -22.5
      L -19.5 -11.25
      L -19.5 11.25
      L 0 22.5
      L 19.5 11.25
      L 19.5 -11.25
      z
    "></path>
  <path fill="#bae6fd" d="
      M 0 -22.5
      L -19.5 -11.25
      L 0 0
      L 19.5 -11.25
      z
    "></path>
  <path fill="none" stroke="currentColor" stroke-width="5" d="
      M -18 -53
      L -10 -53
      L -10 -29.2
      L -30.3 -17.5
      L -30.3 17.5
      L 0 35
      L 30.3 17.5
      L 30.3 -17.5
      L 10 -29.2
      L 10 -53
      L 18 -53
    "></path>
</svg>

        
      </span>
    
    
      <span class="title-text" data-tooltip="Home">
        
          <span class="title">Ashmore Lab</span>
        
        
          <span class="subtitle">Computational physics and ML research group</span>
        
      </span>
    
  </a>

  <input class="nav-toggle" type="checkbox" aria-label="show/hide nav">

  <nav>
    
    
      
        <a href="/research/" data-tooltip="Published works">
          Research
        </a>
      
    
      
        <a href="/teaching/" data-tooltip="Software, datasets, and more">
          Teaching
        </a>
      
    
      
        <a href="/talks/" data-tooltip="Presentations and invited seminars">
          Talks
        </a>
      
    
      
        <a href="/team/" data-tooltip="About our team">
          Team
        </a>
      
    
      
        <a href="/blog/" data-tooltip="Musings and miscellany">
          Blog
        </a>
      
    
      
        <a href="/contact/" data-tooltip="Email, address, and location">
          Contact
        </a>
      
    
  </nav>
</header>

    <main>
      <!--
  modify main content of page:
  - add section breaks
  - attach section properties
  - filter out blank sections
-->






  
  
  

  <section class="background" data-size="1">
    <!--
  background: ;
  dark: ;
  size: 1;
-->


<h1 class="center">Mathematica tips for numerical linear algebra (4)</h1>

<div class="post-info">
  
    
    
      



<div class="portrait-wrapper">
  <a href="/members/anthony-ashmore.html" class="portrait" data-style="tiny" aria-label="Anthony Ashmore">
    
      <i class="icon fa-solid fa-microscope"></i>
    

    <img src="/images/ashmore.jpg" class="portrait-image" alt="member portrait" loading="lazy" onerror="this.src = '/images/fallback.svg'; this.onerror = null;">

    
      <span class="portrait-name">
        Anthony Ashmore
      </span>
    

    
      <span class="portrait-description">
        Assistant Professor
      </span>
    

    
      <span class="portrait-affiliation">
        Skidmore College
      </span>
    
  </a>
</div>

    
  

  
  

  
    <span data-tooltip="Originally published on">
      <i class="icon fa-regular fa-calendar"></i>
      <span>October 14, 2022</span>
    </span>
  

  
</div>


  


  <div class="tags" data-link="https://aashmore.github.io/blog">
    
      <a href="https://aashmore.github.io/blog?search=%22tag:%20mathematica%22" class="tag" data-tooltip='Show items with the tag "mathematica"'>
        mathematica
      </a>
    
      <a href="https://aashmore.github.io/blog?search=%22tag:%20linear-algebra%22" class="tag" data-tooltip='Show items with the tag "linear-algebra"'>
        linear-algebra
      </a>
    
  </div>
  </section>

  
  
  

  <section class="background" data-size="page">
    <!--
  background: ;
  dark: ;
  size: ;
-->


<h2 id="transpose-and-flatten">Transpose and Flatten</h2>

<!-- excerpt start -->
<p>So now we know how to multiply matrices using Mathematica’s <code class="language-plaintext highlighter-rouge">Dot</code> function. This also works for higher-rank tensors (more indices) such as $m_{abc} n_{cde} = (mn)_{abde}$, which we can implement as
<!-- excerpt end --></p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="p">}]</span><span class="o">;</span><span class="w">
</span><span class="nv">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">30</span><span class="o">,</span><span class="w"> </span><span class="m">40</span><span class="o">,</span><span class="w"> </span><span class="m">50</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nv">m</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,20,30} *)</span><span class="w">
</span><span class="nv">n</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {30,40,50} *)</span><span class="w">

</span><span class="nv">m</span><span class="o">.</span><span class="nv">n</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,20,40,50} *)</span><span class="w">
</span></code></pre></div></div>

<p>Here we used <code class="language-plaintext highlighter-rouge">Dimensions</code> to see that check that $m_{abc}$ is indeed a rank-three tensor of size <code class="language-plaintext highlighter-rouge">{10,20,30}</code>, and that <code class="language-plaintext highlighter-rouge">Dot</code> contracts the adjacent indices in <code class="language-plaintext highlighter-rouge">m.n</code>, leaving the remaining indices in the same order.</p>

<p>What if the indices we want to contract aren’t adjacent? The trick is to shuffle the indices of our tensors using either <code class="language-plaintext highlighter-rouge">Transpose</code> or <code class="language-plaintext highlighter-rouge">Flatten</code>.</p>

<h2 id="transpose">Transpose</h2>

<p>Let’s start with <code class="language-plaintext highlighter-rouge">Transpose</code>. Given a tensor $m$, the two simplest uses of this function are <code class="language-plaintext highlighter-rouge">Transpose[m]</code> and <code class="language-plaintext highlighter-rouge">Transpose[m, k&lt;-&gt;l]</code>. The first of these transposes the first two indices of $m$:</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nv">m</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,20,30} *)</span><span class="w">
</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">m</span><span class="p">]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {20,10,30} *)</span><span class="w">
</span></code></pre></div></div>

<p>The second form of the function allows us to specify which indices are transposed. For example, taking <code class="language-plaintext highlighter-rouge">k=1</code> and <code class="language-plaintext highlighter-rouge">l=3</code> will transpose the 1st and 3rd indices of $m$:</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nv">m</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,20,30} *)</span><span class="w">
</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-&gt;</span><span class="w"> </span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {30,20,10} *)</span><span class="w">
</span></code></pre></div></div>

<p>Using this second form, we can contract tensors such as $m_{abc} p_{dec}$:</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="p">}]</span><span class="o">;</span><span class="w">
</span><span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">40</span><span class="o">,</span><span class="w"> </span><span class="m">50</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nv">m</span><span class="o">.</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">p</span><span class="o">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-&gt;</span><span class="w"> </span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,20,50,40} *)</span><span class="w">
</span></code></pre></div></div>

<p>What if we want the indices of the resulting tensor to be ordered as <code class="language-plaintext highlighter-rouge">{10,20,40,50}</code> instead of <code class="language-plaintext highlighter-rouge">{10,20,50,40}</code>? Obviously, we could do the calculation in two steps, first constructing the product as above, and then taking a further transpose on the 3rd and 4th indices. Fortunately, <code class="language-plaintext highlighter-rouge">Transpose</code> can do this in one step. The result of <code class="language-plaintext highlighter-rouge">Transpose[m, {k1, k2, k3}]</code> is a tensor such that the 1st index of $m$ becomes the <code class="language-plaintext highlighter-rouge">k1</code>-th index, the 2nd index of $m$ becomes the <code class="language-plaintext highlighter-rouge">k2</code>-th index, and so on. For example, swapping the first two indices of $m$ is implemented as</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">2</span><span class="o">,</span><span class="w"> </span><span class="m">1</span><span class="o">,</span><span class="w"> </span><span class="m">3</span><span class="p">}]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {20,10,30} *)</span><span class="w">
</span></code></pre></div></div>

<p>which we interpret as sending the 1st index to position 2, the 2nd index to position 1, and leaving the 3rd index unchanged.</p>

<p>We can then perform the contraction of $m$ and $p$ as above but with the 3rd and 4th indices swapped as</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="p">}]</span><span class="o">;</span><span class="w">
</span><span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">40</span><span class="o">,</span><span class="w"> </span><span class="m">50</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nv">m</span><span class="o">.</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">p</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">3</span><span class="o">,</span><span class="w"> </span><span class="m">2</span><span class="o">,</span><span class="w"> </span><span class="m">1</span><span class="p">}]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,20,50,40} *)</span><span class="w">
</span></code></pre></div></div>

<p>The key to remember how this form of Transpose works is that <em>you specify where the indices end up</em>.</p>

<h2 id="flatten">Flatten</h2>

<p>We can also shuffle indices with the function <code class="language-plaintext highlighter-rouge">Flatten</code>. This function also has other uses – such as letting us contract more than one index at a time – but we’ll focus on using it to transpose for the moment.</p>

<p>The key with <code class="language-plaintext highlighter-rouge">Flatten</code> is that <em>you specify where the indices came from</em>. For example, compare</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="o">,</span><span class="w"> </span><span class="m">40</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">1</span><span class="o">,</span><span class="w"> </span><span class="m">4</span><span class="o">,</span><span class="w"> </span><span class="m">2</span><span class="o">,</span><span class="w"> </span><span class="m">3</span><span class="p">}]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,30,40,20} *)</span><span class="w">

</span><span class="nb">Flatten</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{{</span><span class="m">1</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">4</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">2</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">3</span><span class="p">}}]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,40,20,30} *)</span><span class="w">
</span></code></pre></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">Transpose</code> with the argument <code class="language-plaintext highlighter-rouge">{1, 4, 2, 3}</code>, we leave the 1st index unchanged, send the 2nd index to 4th position, send the 3rd index to 2nd position, and send the 4th index to 3rd position. Using <code class="language-plaintext highlighter-rouge">Flatten</code> with the argument <code class="language-plaintext highlighter-rouge">{{1}, {4}, {2}, {3}}</code>, we leave the 1st index unchanged, set the 2nd index of the result to be the 4th index of the original tensor, set the 3rd index of the result to be the 2nd index of the original tensor, and finally set the 4th index of the result to be the 3rd index of the original tensor. These operations are not the same! And the difference is whether you are thinking about <em>where to send the indices to</em> or <em>where the indices came from</em>.</p>

<p>If we want the same result from both, we would use</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">20</span><span class="o">,</span><span class="w"> </span><span class="m">30</span><span class="o">,</span><span class="w"> </span><span class="m">40</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">1</span><span class="o">,</span><span class="w"> </span><span class="m">4</span><span class="o">,</span><span class="w"> </span><span class="m">2</span><span class="o">,</span><span class="w"> </span><span class="m">3</span><span class="p">}]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,30,40,20} *)</span><span class="w">

</span><span class="nb">Flatten</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{{</span><span class="m">1</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">3</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">4</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">2</span><span class="p">}}]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w">
</span><span class="c">(* {10,40,20,30} *)</span><span class="w">

</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">1</span><span class="o">,</span><span class="w"> </span><span class="m">4</span><span class="o">,</span><span class="w"> </span><span class="m">2</span><span class="o">,</span><span class="w"> </span><span class="m">3</span><span class="p">}]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">Flatten</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{{</span><span class="m">1</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">3</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">4</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">2</span><span class="p">}}]</span><span class="w">
</span><span class="c">(* True *)</span><span class="w">
</span></code></pre></div></div>

<p>Note that if you just need to transpose a tensor, <code class="language-plaintext highlighter-rouge">Tranpose</code> is often faster than <code class="language-plaintext highlighter-rouge">Flatten</code>. For example, increasing the dimensions of $m$ somewhat:</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">RandomComplex</span><span class="p">[{}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">10</span><span class="o">,</span><span class="w"> </span><span class="m">200</span><span class="o">,</span><span class="w"> </span><span class="m">300</span><span class="o">,</span><span class="w"> </span><span class="m">400</span><span class="p">}]</span><span class="o">;</span><span class="w">

</span><span class="nb">Transpose</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">1</span><span class="o">,</span><span class="w"> </span><span class="m">4</span><span class="o">,</span><span class="w"> </span><span class="m">2</span><span class="o">,</span><span class="w"> </span><span class="m">3</span><span class="p">}]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">RepeatedTiming</span><span class="w">
</span><span class="c">(* {0.60360695, {10,300,400,200}} *)</span><span class="w">

</span><span class="nb">Flatten</span><span class="p">[</span><span class="nv">m</span><span class="o">,</span><span class="w"> </span><span class="p">{{</span><span class="m">1</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">3</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">4</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="m">2</span><span class="p">}}]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">Dimensions</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">RepeatedTiming</span><span class="w">
</span><span class="c">(* {4.8638016, {10,300,400,200}} *)</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Flatten</code> is 8 times slower than <code class="language-plaintext highlighter-rouge">Tranpose</code> in this case! If you have to repeat this operation many thousands of times, this could become a huge bottleneck!</p>
  </section>

  
  
  

  <section class="background" data-size="page">
    <!--
  background: ;
  dark: ;
  size: ;
-->


<div class="post-nav">
  <span>
    
      <i class="icon fa-solid fa-angle-left"></i> Previous post<br>
      <a href="/2022/06/23/mathematica-3.html">
        Mathematica tips for numerical linear algebra (3)
      </a>
    
  </span>
  <span>
    
  </span>
</div>
  </section>


    </main>
    


<footer class="background" style="--image: url('/images/background.jpg')" data-dark="true" data-size="wide">
  <!--
    <div>
      Extra details like contact info or address
    </div>
  -->

  <div>
    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="mailto:aashmore@skidmore.edu" data-tooltip="Email" data-style="bare" aria-label="Email">
      <i class="icon fa-solid fa-envelope"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://orcid.org/0000-0001-6178-7538" data-tooltip="ORCID" data-style="bare" aria-label="ORCID">
      <i class="icon fa-brands fa-orcid"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://scholar.google.com/citations?user=XwF3jY4AAAAJ" data-tooltip="Google Scholar" data-style="bare" aria-label="Google Scholar">
      <i class="icon fa-brands fa-google"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://github.com/aashmore" data-tooltip="GitHub" data-style="bare" aria-label="GitHub">
      <i class="icon fa-brands fa-github"></i>
      
    </a>
  </div>


    
  </div>

  <div>
    © 2024
    Ashmore Lab
      |   Built with
    <a href="https://github.com/greenelab/lab-website-template">
      Lab Website Template
    </a>
  </div>

  <input type="checkbox" class="dark-toggle" data-tooltip="Dark mode" aria-label="toggle dark mode" oninput="onDarkToggleChange(event)">
</footer>

  </body>
</html>
